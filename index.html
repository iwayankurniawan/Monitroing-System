<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="keywords" lang="de" content="Zeitleiste, Zeitlinie, Zeitkarte, Geschichte, Chronologie">
    <meta name="keywords" lang="en" content="Timeline, Timemap, History, Chronology">
    <title>Timeline - Proof-of-concept</title>

    <!-- That's the 'official' path. Comment out, when working locally. -->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


    <script src="View/stackedbar.js"></script>
    <link href="View/CSS/stackedbar.css" rel="stylesheet" type="text/css" />

    <!-- Store these two files in your application directory or on your path. -->
    <script src="View/newTimeline.js"></script>
    <link href="View/CSS/timeline.css" rel="stylesheet" type="text/css" />

    <script src="Model/dataModel.js"></script>
    <link href="View/CSS/index.css" rel="stylesheet" type="text/css" />

    <script src="View/viewDetail.js"></script>
    <link href="View/CSS/detailView.css" rel="stylesheet" type="text/css" />

    <script src="Model/fisheye.js"></script>

</head>

<body>

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-8" id="Left-View" >
      <div class="sticky">
        <div class="col-lg-2 controlPanel" >
          <div class="row">
            <button style="font-size: 9px;" class="col-sm-6" name="button" id="selectAll" onclick="selectAllCheckbox()" value="selectAll" >Select All</button>
            <button style="font-size: 9px;" class="col-sm-6" name="button" id="unselectAll" onclick="unselectAllCheckbox()" value="unselectAll" >Unselect All</button>
          </div>
            <div class="row" id="legendPanel"></div>
            <div class="row">
              <form name="form" id="form" onsubmit="return false">
                <input type="datetime-local" id="mindate" name="mindate" value="2019-01-14T14:36:11">
                <input type="datetime-local" id="maxDate"  name="maxDate" value="2019-01-15T13:38:40">
                <select name="sort" id="channel-sort">
                  <option value="1">Recent Error</option>
                  <option value="4">Name (A to Z)</option>
                  <option value="2">Name (Z to A)</option>
                </select>
                <select id="channel-options" name="show-error">
                  <option value="1">Show All Channels</option>
                  <option value="2">Show Only Channels With Error</option>
                </select>
                <button name="button" id="button" onclick="changeValue()" value="before" >Search</button>
              </form>
            </div>
        </div>

        <div class="col-lg-10" id="main-panel">
          <div id="panel">
            <div id="mbars"></div>
            <div id="naviBarClass"></div>
          </div>
        </div>
      </div>

      <div class="row" id="timeline">
      </div>

    </div>

    <div class="col-sm-4 sticky" id="Right-View">
      <div class="row" style="margin-top:3px;">
        <div class="col-sm-3"></div>
        <button style="font-size: 13px; margin-left:0px;" class="col-sm-3" name="button" id="backClicked" onclick="backClicked()" value="Back" ><i class="arrow left"></i> Back</button>
        <button style="font-size: 13px; margin-left:5px;" class="col-sm-3" name="button" id="nextClicked" onclick="nextClicked()" value="Next" >Next <i class="arrow right"></i></button>
      </div>
      <h5 class="row" style="padding-left:7px;font-weight:bold;">Search History</h5>
      <div class="row" id="search-history-panel"></div>
      <h5 class="row" style="padding-left:7px;font-weight:bold;">Channel Detail</h5>
      <div class="row" id="Detail-Quality-View">
        <h6 class="detail-title">Channel Quality</h6>
        <div class="col-sm-6" id="quality-detail"></div>
        <div class="col-sm-6" id="legend-quality-detail"></div>
      </div>
      <div class="row" id="Detail-View">
        <h6 class="detail-title">Error Detail</h6>
        <div id="error-detail"></div>
      </div>
      <div class="row" id="Detail-Location-View">
        <h6 class="detail-title">Error Location</h6>
        <div id="error-location-detail"></div>
      </div>
    </div>
  </div>
</div>




<script>

  //Timeline Geometry
  var leftNameMargin = 200;
  var moveAxis = 9;
  var margin = {top: 2, right: 20, bottom: 20, left: leftNameMargin},
  outerWidth = 990,
  outerHeight = 1850,
  width = outerWidth - margin.left - margin.right,
  height = outerHeight - margin.top - margin.bottom;
  naviHeight = 101;
  searchStatus = false;
  var paddingValueFromStackedbar = {};
  var widthFromStackedBar;
  var heightFromStackedBar;

  //buildTimeline();
  var minDate =changeValueMinDate();
  var maxDate = changeValueMaxDate();

  var domElement = "#timeline";
  var sourceFile = "Model/test.csv";

  $("#backClicked").prop( "disabled", true );
  $("#nextClicked").prop( "disabled", true );


  // Read in the data and construct the timeline
  d3.csv(sourceFile, function(dataset) {
    // Define domElement and sourceFile
    timeline(domElement,changeValueMinDate(),changeValueMaxDate(),$( "#channel-sort" ).val(),$( "#channel-options" ).val(),removeListAlarm)
    .data(dataset)
    .bandNaviBand("naviBand", 0.015)
    .band("mainBand", 0.98) //sumation of this supposed to be 0.9
    .legend("mainBand", 0.98)
    .xAxis("mainBand","top")
    .tooltips("mainBand")
    //.xAxis("naviBand")
    .labels("mainBand")
    .labels("naviBand")
    .brush("naviBand", ["mainBand"])
    .redraw();

    //stackedbar(getDataFromTimeline()).legend();

    //clicked on Error to show error detail
    $('.interval').on('click', function(e){
      var target;
      if (target == e.target.id){
        return;
      }else{
        setDetailView(getDataFromTimeline().items[e.target.id]);
        d3.select("#quality-detail").remove();
        d3.select("#legend-quality-detail").remove();
        d3.select("#error-detail").remove();
        d3.select("#error-location-detail").remove();
      }
      target = e.target.id;
    });

    //clicked Stackedbar to change min and max date
    $('.rect-stacked-bar').on('click', function(e){
      $(".tooltips").remove();
      $("#svg").remove();
      $("#svg").remove();
      $("#svg").remove();
      $(".chart").remove();
      $("#searchHistory").remove();


      $('#mindate').val(setValueMinDateFromStackedBar(e.target.id));
      $('#maxDate').val(setValueMaxDateFromStackedBar(e.target.id));


      buildTimeline(setValueMinDateFromStackedBar(e.target.id),setValueMaxDateFromStackedBar(e.target.id),$( "#channel-sort" ).val(),$( "#channel-options" ).val(),removeListAlarm);

      searchHistoryList.push({'minDate':setValueMinDateFromStackedBar(e.target.id),'maxDate':setValueMaxDateFromStackedBar(e.target.id),'sortType':$( "#channel-sort" ).val(),'channelOptions':$( "#channel-options" ).val(),'removealarm':removeListAlarm});
      setSearchHistoryList(searchHistoryList);
    });
  });

</script>

</body>

</html>
